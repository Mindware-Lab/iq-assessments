<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cognitive Mode Check - Zone Coach</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Custom slider styling */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #2764B7;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      background: #22AAFF;
    }

    input[type="range"]::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #2764B7;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    input[type="range"]::-moz-range-thumb:hover {
      background: #22AAFF;
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 8px;
      border-radius: 4px;
    }

    input[type="range"]::-moz-range-track {
      height: 8px;
      border-radius: 4px;
      background: #E0E0E0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CognitiveModeCheck = () => {
      const [step, setStep] = useState('sliders');
      const [sliders, setSliders] = useState({
        energy: 5,
        stress: 5,
        focus: 5,
        noise: 5,
        overwhelm: 5
      });
      const [slidersTouched, setSlidersTouched] = useState({
        energy: false,
        stress: false,
        focus: false,
        noise: false,
        overwhelm: false
      });
      const [showNeutralWarning, setShowNeutralWarning] = useState(false);
      const [breathingActive, setBreathingActive] = useState(false);
      const [breathElapsed, setBreathElapsed] = useState(0);
      const [currentPhase, setCurrentPhase] = useState({ label: 'Inhale', progress: 0, isInhale: true });
      const [countdownValue, setCountdownValue] = useState(3);
      const [postBreathMode, setPostBreathMode] = useState(null);
      const [sessionResults, setSessionResults] = useState(null);
      const animationFrameRef = useRef(null);
      const startTimeRef = useRef(null);
      const audioContextRef = useRef(null);
      const countdownIntervalRef = useRef(null);

      const sliderDefinitions = [
        { 
          id: 'energy', 
          label: 'Energy',
          leftAnchor: 'Very low / flat',
          rightAnchor: 'High / ready'
        },
        { 
          id: 'stress', 
          label: 'Stress Load',
          leftAnchor: 'Calm / settled',
          rightAnchor: 'Tense / keyed-up'
        },
        { 
          id: 'focus', 
          label: 'Focus Stability',
          leftAnchor: 'Scattered',
          rightAnchor: 'Locked-in focus'
        },
        { 
          id: 'noise', 
          label: 'Cognitive Noise',
          leftAnchor: 'Quiet mind',
          rightAnchor: 'Racing thoughts'
        },
        { 
          id: 'overwhelm', 
          label: 'Overwhelm',
          leftAnchor: 'Fully manageable',
          rightAnchor: 'Too much / overloaded'
        }
      ];

      const breathPatterns = {
        upshift: {
          name: "Upshift",
          description: "Gentle activation to build energy",
          rationale: "Low activation/engagement ‚Üí gentle upshift",
          instructions: "Breathe through your nose if comfortable. Light, gentle breaths‚Äîno deep gulps.",
          phases: [
            ...Array(10).fill(null).flatMap(() => [
              { label: 'Inhale', duration: 3000 },
              { label: 'Exhale', duration: 3000 }
            ]),
            ...Array(12).fill(null).flatMap(() => [
              { label: 'Inhale', duration: 4000 },
              { label: 'Exhale', duration: 6000 }
            ])
          ]
        },
        amplify: {
          name: "Amplify",
          description: "Resonance breathing to maintain optimal state",
          rationale: "Balanced and engaged ‚Üí stabilise and amplify",
          instructions: "Breathe comfortably through your nose, keeping breaths belly-led and smooth.",
          phases: Array(18).fill(null).flatMap(() => [
            { label: 'Inhale', duration: 4000 },
            { label: 'Exhale', duration: 6000 }
          ])
        },
        downshift: {
          name: "Downshift",
          description: "Cyclic sighing to reduce tension",
          rationale: "High load/noise ‚Üí downshift",
          instructions: "Two short inhales through your nose (second tops up the first), then a long sigh out through your mouth.",
          phases: Array(20).fill(null).flatMap(() => [
            { label: 'Inhale (1)', duration: 1000 },
            { label: 'Inhale (2)', duration: 1000 },
            { label: 'Sigh Out', duration: 7000 }
          ])
        }
      };

      const playBeep = () => {
        try {
          if (!audioContextRef.current) {
            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
          }
          const ctx = audioContextRef.current;
          const oscillator = ctx.createOscillator();
          const gainNode = ctx.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);
          
          oscillator.frequency.value = 440;
          oscillator.type = 'sine';
          gainNode.gain.value = 0.1;
          
          oscillator.start(ctx.currentTime);
          oscillator.stop(ctx.currentTime + 0.1);
        } catch (error) {
          console.warn('Audio beep failed:', error);
        }
      };

      const calculateResults = () => {
        const E = sliders.energy;
        const S = sliders.stress;
        const F = sliders.focus;
        const N = sliders.noise;
        const O = sliders.overwhelm;

        const prototypes = {
          subcritical: [2, 2, 3, 2, 2],
          inZone: [6, 4, 7, 3, 3],
          supercritical: [6, 8, 3, 8, 8]
        };

        let mode = null;
        
        if (O >= 7 || S >= 7 || N >= 7) {
          mode = 'Supercritical (Overloaded)';
        }
        
        if (!mode && E <= 3 && F <= 4 && S <= 4 && O <= 4) {
          mode = 'Subcritical (Flat)';
        }

        let patternId = '';
        let confidence = 'High';
        let margin = 0;
        
        if (!mode) {
          const userVector = [E, S, F, N, O];
          
          const distance = (p1, p2) => {
            return Math.sqrt(p1.reduce((sum, val, i) => sum + Math.pow(val - p2[i], 2), 0));
          };

          const dF = distance(prototypes.subcritical, userVector);
          const dZ = distance(prototypes.inZone, userVector);
          const dO = distance(prototypes.supercritical, userVector);

          const distances = [
            { mode: 'Subcritical (Flat)', dist: dF },
            { mode: 'In the Zone', dist: dZ },
            { mode: 'Supercritical (Overloaded)', dist: dO }
          ].sort((a, b) => a.dist - b.dist);

          const d1 = distances[0].dist;
          const d2 = distances[1].dist;
          margin = d2 - d1;

          if (margin < 1.2) {
            mode = 'Mixed / Unclear';
            confidence = 'Low';
          } else {
            mode = distances[0].mode;
            
            if (mode === 'In the Zone') {
              const gatePass = E >= 5 && F >= 6 && O <= 5 && S <= 6 && N <= 6;
              if (!gatePass) {
                mode = 'Mixed / Unclear';
                confidence = 'Low';
              }
            }
            
            if (margin >= 2.5) {
              confidence = 'High';
            } else if (margin >= 1.2) {
              confidence = 'Medium';
            }
          }
        }

        if (mode === 'Subcritical (Flat)') {
          patternId = 'upshift';
        } else if (mode === 'In the Zone') {
          patternId = 'amplify';
        } else if (mode === 'Supercritical (Overloaded)') {
          patternId = 'downshift';
        } else if (mode === 'Mixed / Unclear') {
          if (O >= 6 || S >= 6 || N >= 6) {
            patternId = 'downshift';
          } else if (E <= 4) {
            patternId = 'upshift';
          } else {
            patternId = 'amplify';
          }
        }

        let bgColor = '';
        let borderColor = '';
        
        if (mode === 'Subcritical (Flat)') {
          bgColor = '#E8F4FF';
          borderColor = '#22AAFF';
        } else if (mode === 'In the Zone') {
          bgColor = '#F5FFE6';
          borderColor = '#CCFF66';
        } else if (mode === 'Supercritical (Overloaded)') {
          bgColor = '#FFE8E8';
          borderColor = '#FF6B6B';
        } else {
          bgColor = '#F5F5F5';
          borderColor = '#6D6D6D';
        }

        return {
          mode,
          confidence,
          margin: margin.toFixed(2),
          sliderValues: { E, S, F, N, O },
          patternId,
          rationale: breathPatterns[patternId].rationale,
          bgColor,
          borderColor
        };
      };

      const handleSliderChange = (id, value) => {
        setSliders(prev => ({ ...prev, [id]: parseInt(value) }));
        setSlidersTouched(prev => ({ ...prev, [id]: true }));
        setShowNeutralWarning(false);
      };

      const allSlidersNeutral = () => {
        return Object.values(sliders).every(val => val === 5);
      };

      const handleSubmitSliders = () => {
        if (allSlidersNeutral()) {
          setShowNeutralWarning(true);
        } else {
          proceedToCountdown();
        }
      };

      const proceedToCountdown = () => {
        const results = calculateResults();
        setSessionResults(results);
        setStep('countdown');
        setCountdownValue(3);
        startCountdown(results);
      };

      const startCountdown = (results) => {
        if (countdownIntervalRef.current) clearInterval(countdownIntervalRef.current);

        countdownIntervalRef.current = setInterval(() => {
          setCountdownValue(prev => {
            const next = prev - 1;
            if (next <= 0) {
              clearInterval(countdownIntervalRef.current);
              startBreathing(results);
              return 0;
            }
            return next;
          });
        }, 1000);
      };

      const skipCountdown = () => {
        if (countdownIntervalRef.current) {
          clearInterval(countdownIntervalRef.current);
        }
        startBreathing(sessionResults);
      };

      const startBreathing = (results) => {
        if (!results) {
          console.error('No results provided to startBreathing');
          return;
        }
        
        setStep('breath');
        setBreathingActive(true);
        startTimeRef.current = performance.now();
        
        try {
          if (!audioContextRef.current) {
            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
          }
          if (audioContextRef.current.state === 'suspended') {
            audioContextRef.current.resume();
          }
        } catch (error) {
          console.warn('Audio context initialization failed:', error);
        }
        
        animateBreath(results.patternId);
      };

      const animateBreath = (patternId) => {
        const now = performance.now();
        const elapsed = now - startTimeRef.current;
        const totalDuration = 180000;
        
        if (elapsed >= totalDuration) {
          setBreathingActive(false);
          setStep('recheck');
          cancelAnimationFrame(animationFrameRef.current);
          return;
        }
        
        setBreathElapsed(elapsed);
        
        const pattern = breathPatterns[patternId];
        
        if (!pattern || !pattern.phases || pattern.phases.length === 0) {
          console.error('Invalid pattern:', patternId, pattern);
          return;
        }
        
        let cumulativeTime = 0;
        
        for (let i = 0; i < pattern.phases.length; i++) {
          const phase = pattern.phases[i];
          if (elapsed >= cumulativeTime && elapsed < cumulativeTime + phase.duration) {
            const phaseElapsed = elapsed - cumulativeTime;
            const progress = phaseElapsed / phase.duration;
            
            setCurrentPhase({
              label: phase.label,
              progress: progress,
              isInhale: phase.label.includes('Inhale')
            });
            
            if (phaseElapsed < 50) {
              playBeep();
            }
            
            break;
          }
          cumulativeTime += phase.duration;
        }
        
        animationFrameRef.current = requestAnimationFrame(() => animateBreath(patternId));
      };

      const handlePostBreathCheck = (mode) => {
        setPostBreathMode(mode);
        setStep('summary');
      };

      const handleReset = () => {
        setSliders({
          energy: 5,
          stress: 5,
          focus: 5,
          noise: 5,
          overwhelm: 5
        });
        setSlidersTouched({
          energy: false,
          stress: false,
          focus: false,
          noise: false,
          overwhelm: false
        });
        setShowNeutralWarning(false);
        setStep('sliders');
        setBreathingActive(false);
        setBreathElapsed(0);
        setSessionResults(null);
        setPostBreathMode(null);
        if (animationFrameRef.current) {
          cancelAnimationFrame(animationFrameRef.current);
        }
        if (countdownIntervalRef.current) {
          clearInterval(countdownIntervalRef.current);
        }
      };

      useEffect(() => {
        return () => {
          if (animationFrameRef.current) {
            cancelAnimationFrame(animationFrameRef.current);
          }
          if (countdownIntervalRef.current) {
            clearInterval(countdownIntervalRef.current);
          }
        };
      }, []);

      // Countdown screen
      if (step === 'countdown' && sessionResults) {
        const pattern = breathPatterns[sessionResults.patternId];
        
        return (
          <div style={{ minHeight: '100vh', padding: '1rem 2rem', backgroundColor: '#E0E0E0' }}>
            <div style={{ maxWidth: '48rem', margin: '0 auto' }}>
              <div style={{ borderRadius: '0.5rem', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)', padding: '2rem', backgroundColor: '#FFFFFF' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1.5rem' }}>
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L12 22M12 2L8 6M12 2L16 6M12 22L8 18M12 22L16 18M6 8L6 16M18 8L18 16" 
                          stroke="#2764B7" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                  </svg>
                  <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#333333' }}>Get Ready</h1>
                </div>

                <div style={{ textAlign: 'center', padding: '3rem 0' }}>
                  <div style={{ fontSize: '6rem', fontWeight: 'bold', marginBottom: '1.5rem', color: '#2764B7' }}>
                    {countdownValue}
                  </div>
                  <h2 style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.5rem', color: '#333333' }}>
                    {pattern.name} Breathing
                  </h2>
                  <p style={{ fontSize: '1.125rem', marginBottom: '2rem', color: '#6D6D6D' }}>
                    {pattern.description}
                  </p>
                  <p style={{ fontSize: '0.875rem', marginBottom: '2rem', color: '#333333' }}>
                    {pattern.instructions}
                  </p>
                  
                  <button
                    onClick={skipCountdown}
                    style={{ 
                      padding: '0.75rem 1.5rem', 
                      borderRadius: '0.5rem', 
                      fontWeight: '600',
                      border: '2px solid #2764B7',
                      color: '#2764B7',
                      backgroundColor: '#FFFFFF',
                      cursor: 'pointer',
                      transition: 'all 0.2s'
                    }}
                    onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#E8F4FF'}
                    onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#FFFFFF'}
                  >
                    Start Now
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Breathing exercise screen
      if (step === 'breath' && sessionResults) {
        const pattern = breathPatterns[sessionResults.patternId];
        const remainingMs = 180000 - breathElapsed;
        const remainingMin = Math.floor(remainingMs / 60000);
        const remainingSec = Math.floor((remainingMs % 60000) / 1000);
        
        const baseSize = 120;
        const expandedSize = 200;
        const currentSize = currentPhase.isInhale 
          ? baseSize + (expandedSize - baseSize) * currentPhase.progress
          : expandedSize - (expandedSize - baseSize) * currentPhase.progress;

        return (
          <div style={{ minHeight: '100vh', padding: '1rem 2rem', backgroundColor: '#E0E0E0' }}>
            <div style={{ maxWidth: '48rem', margin: '0 auto' }}>
              <div style={{ borderRadius: '0.5rem', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)', padding: '2rem', backgroundColor: '#FFFFFF' }}>
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '1.5rem' }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 2L12 22M12 2L8 6M12 2L16 6M12 22L8 18M12 22L16 18M6 8L6 16M18 8L18 16" 
                            stroke="#2764B7" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                    </svg>
                    <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#333333' }}>{pattern.name} Breathing</h1>
                  </div>
                  <div style={{ textAlign: 'right' }}>
                    <div style={{ fontSize: '0.875rem', fontWeight: '600', color: '#6D6D6D' }}>Time Remaining</div>
                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#2764B7' }}>
                      {remainingMin}:{remainingSec.toString().padStart(2, '0')}
                    </div>
                  </div>
                </div>

                <p style={{ textAlign: 'center', marginBottom: '0.5rem', color: '#6D6D6D' }}>{pattern.description}</p>
                <p style={{ textAlign: 'center', marginBottom: '2rem', fontSize: '0.875rem', fontWeight: '500', color: '#333333' }}>{pattern.instructions}</p>

                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: '3rem 0' }}>
                  <div 
                    style={{
                      width: `${currentSize}px`,
                      height: `${currentSize}px`,
                      backgroundColor: currentPhase.isInhale ? '#22AAFF' : '#2764B7',
                      borderRadius: '50%',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      boxShadow: '0 8px 32px rgba(39, 100, 183, 0.3)',
                      transition: 'all 0.1s'
                    }}
                  >
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#FFFFFF' }}>
                        {currentPhase.label}
                      </div>
                    </div>
                  </div>
                  
                  <div style={{ width: '100%', maxWidth: '28rem', marginTop: '3rem', borderRadius: '9999px', overflow: 'hidden', backgroundColor: '#E0E0E0', height: '8px' }}>
                    <div 
                      style={{
                        height: '100%',
                        width: `${(breathElapsed / 180000) * 100}%`,
                        backgroundColor: '#2764B7',
                        transition: 'all 0.1s'
                      }}
                    />
                  </div>
                  
                  <p style={{ marginTop: '1rem', fontSize: '0.875rem', color: '#6D6D6D' }}>
                    Follow the breathing cues. A soft beep marks each phase change.
                  </p>
                </div>

                <div style={{ marginTop: '1.5rem', padding: '1rem', borderRadius: '0.5rem', backgroundColor: '#FFF9E6', border: '1px solid #FFD700' }}>
                  <p style={{ fontSize: '0.875rem', fontWeight: '500', color: '#333333' }}>
                    ‚ö†Ô∏è <strong>Safety note:</strong> If you feel dizzy or unwell, stop and return to normal breathing. Avoid breathwork if you have a condition where this is unsafe.
                  </p>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Post-breath recheck screen
      if (step === 'recheck' && sessionResults) {
        return (
          <div style={{ minHeight: '100vh', padding: '1rem 2rem', backgroundColor: '#E0E0E0' }}>
            <div style={{ maxWidth: '48rem', margin: '0 auto' }}>
              <div style={{ borderRadius: '0.5rem', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)', padding: '2rem', backgroundColor: '#FFFFFF' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1.5rem' }}>
                  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L12 22M12 2L8 6M12 2L16 6M12 22L8 18M12 22L16 18M6 8L6 16M18 8L18 16" 
                          stroke="#2764B7" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                  </svg>
                  <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#333333' }}>How do you feel now?</h1>
                </div>

                <p style={{ textAlign: 'center', marginBottom: '2rem', color: '#6D6D6D' }}>
                  You've completed 3 minutes of breathing. Where are you at now?
                </p>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>
                  {[
                    { label: 'Flat', color: '#22AAFF', bg: '#E8F4FF' },
                    { label: 'In the zone', color: '#CCFF66', bg: '#F5FFE6' },
                    { label: 'Overloaded', color: '#FF6B6B', bg: '#FFE8E8' },
                    { label: 'Mixed', color: '#6D6D6D', bg: '#F5F5F5' }
                  ].map(option => (
                    <button
                      key={option.label}
                      onClick={() => handlePostBreathCheck(option.label)}
                      style={{ 
                        padding: '1.5rem', 
                        borderRadius: '0.5rem', 
                        border: `2px solid ${option.color}`,
                        fontWeight: '600',
                        fontSize: '1.125rem',
                        color: '#333333',
                        backgroundColor: '#FFFFFF',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        e.currentTarget.style.backgroundColor = option.bg;
                      }}
                      onMouseLeave={(e) => {
                        e.currentTarget.style.backgroundColor = '#FFFFFF';
                      }}
                    >
                      {option.label}
                    </button>
                  ))}
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Summary screen
      if (step === 'summary' && sessionResults) {
        const shouldRepeat = postBreathMode === 'Overloaded' || postBreathMode === 'Mixed';
        
        return (
          <div style={{ minHeight: '100vh', padding: '1rem 2rem', backgroundColor: '#E0E0E0' }}>
            <div style={{ maxWidth: '56rem', margin: '0 auto' }}>
              <div style={{ borderRadius: '0.5rem', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)', padding: '2rem', backgroundColor: '#FFFFFF' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '1.5rem' }}>
                  <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L12 22M12 2L8 6M12 2L16 6M12 22L8 18M12 22L16 18M6 8L6 16M18 8L18 16" 
                          stroke="#2764B7" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                  </svg>
                  <h1 style={{ fontSize: '1.875rem', fontWeight: 'bold', color: '#333333' }}>Session Complete</h1>
                </div>

                <div style={{ textAlign: 'center', padding: '2rem 0' }}>
                  <svg style={{ width: '5rem', height: '5rem', margin: '0 auto 1rem' }} fill="none" stroke="#22AAFF" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <h2 style={{ fontSize: '1.5rem', fontWeight: 'bold', marginBottom: '0.5rem', color: '#333333' }}>
                    Great work!
                  </h2>
                  <p style={{ fontSize: '1.125rem', marginBottom: '0.5rem', color: '#6D6D6D' }}>
                    You completed 3 minutes of {breathPatterns[sessionResults.patternId].name} breathing.
                  </p>
                  {postBreathMode && (
                    <p style={{ fontSize: '1rem', marginBottom: '2rem', color: '#6D6D6D' }}>
                      Post-breath state: <strong>{postBreathMode}</strong>
                    </p>
                  )}
                </div>

                <div style={{ borderRadius: '0.5rem', border: `2px solid ${sessionResults.borderColor}`, padding: '1.5rem', marginBottom: '1.5rem', backgroundColor: sessionResults.bgColor }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '1rem' }}>
                    <div>
                      <h3 style={{ fontWeight: 'bold', marginBottom: '0.25rem', color: '#333333' }}>Starting Mode</h3>
                      <p style={{ fontSize: '1.25rem', fontWeight: '600', marginBottom: '0.5rem', color: '#2764B7' }}>{sessionResults.mode}</p>
                      <p style={{ fontSize: '0.875rem', marginBottom: '0.5rem', color: '#333333' }}>
                        Confidence: <strong>{sessionResults.confidence}</strong>
                      </p>
                    </div>
                  </div>
                  
                  <div style={{ marginBottom: '1rem' }}>
                    <h4 style={{ fontSize: '0.875rem', fontWeight: 'bold', marginBottom: '0.5rem', color: '#333333' }}>Slider Values (E, S, F, N, O)</h4>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(5, 1fr)', gap: '0.5rem', textAlign: 'center' }}>
                      {['E', 'S', 'F', 'N', 'O'].map(key => (
                        <div key={key} style={{ padding: '0.75rem', borderRadius: '0.25rem', backgroundColor: 'rgba(255, 255, 255, 0.7)' }}>
                          <div style={{ fontSize: '0.75rem', fontWeight: '600', color: '#6D6D6D' }}>{key}</div>
                          <div style={{ fontSize: '1.5rem', fontWeight: 'bold', color: '#333333' }}>{sessionResults.sliderValues[key]}</div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div style={{ paddingTop: '1rem', borderTop: '1px solid rgba(0,0,0,0.1)' }}>
                    <p style={{ fontSize: '0.875rem', fontWeight: '600', color: '#333333' }}>
                      Pattern: {breathPatterns[sessionResults.patternId].name}
                    </p>
                    <p style={{ fontSize: '0.875rem', color: '#333333' }}>
                      {sessionResults.rationale}
                    </p>
                  </div>
                </div>

                {shouldRepeat && (
                  <div style={{ marginBottom: '1.5rem', padding: '1rem', borderRadius: '0.5rem', backgroundColor: '#FFF9E6', border: '1px solid #FFD700' }}>
                    <p style={{ fontSize: '0.875rem', fontWeight: '500', color: '#333333' }}>
                      üí° <strong>Suggestion:</strong> You're still {postBreathMode.toLowerCase()}. Consider repeating the downshift breathing once more, or shortening today's training session.
                    </p>
                  </div>
                )}

                <button
                  onClick={handleReset}
                  style={{ 
                    width: '100%', 
                    padding: '0.75rem 1.5rem', 
                    borderRadius: '0.5rem', 
                    fontWeight: '600',
                    fontSize: '1.125rem',
                    backgroundColor: '#2764B7',
                    color: '#FFFFFF',
                    border: 'none',
                    cursor: 'pointer',
                    boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#1e4f8f'}
                  onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#2764B7'}
                >
                  Start New Session
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Main slider screen
      return (
        <div style={{ minHeight: '100vh', padding: '1rem 2rem', backgroundColor: '#E0E0E0' }}>
          <div style={{ maxWidth: '56rem', margin: '0 auto' }}>
            <div style={{ borderRadius: '0.5rem', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)', padding: '2rem', backgroundColor: '#FFFFFF' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.5rem' }}>
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2L12 22M12 2L8 6M12 2L16 6M12 22L8 18M12 22L16 18M6 8L6 16M18 8L18 16" 
                        stroke="#2764B7" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                </svg>
                <h1 style={{ fontSize: '1.875rem', fontWeight: 'bold', color: '#333333' }}>Zone Check</h1>
              </div>
              <p style={{ marginBottom: '2rem', color: '#6D6D6D' }}>
                <strong>In the last hour</strong>, where are you right now? Move each slider to match your state.
              </p>

              <div style={{ marginBottom: '2rem' }}>
                {sliderDefinitions.map((slider) => (
                  <div key={slider.id} style={{ marginBottom: '2rem' }}>
                    <label style={{ display: 'block', fontWeight: '600', marginBottom: '0.5rem', color: '#333333' }}>
                      {slider.label}
                    </label>
                    <div style={{ position: 'relative' }}>
                      <input
                        type="range"
                        min="0"
                        max="10"
                        value={sliders[slider.id]}
                        onChange={(e) => handleSliderChange(slider.id, e.target.value)}
                        style={{
                          width: '100%',
                          height: '8px',
                          borderRadius: '0.5rem',
                          background: `linear-gradient(to right, #2764B7 0%, #2764B7 ${sliders[slider.id] * 10}%, #E0E0E0 ${sliders[slider.id] * 10}%, #E0E0E0 100%)`
                        }}
                      />
                      <div 
                        style={{ 
                          position: 'absolute',
                          top: '50%',
                          left: '50%',
                          width: '8px',
                          height: '8px',
                          borderRadius: '50%',
                          transform: 'translate(-50%, -50%)',
                          backgroundColor: '#6D6D6D',
                          pointerEvents: 'none'
                        }}
                      />
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '0.5rem' }}>
                      <span style={{ fontSize: '0.875rem', color: '#6D6D6D' }}>{slider.leftAnchor}</span>
                      <span style={{ fontSize: '1.125rem', fontWeight: 'bold', color: '#2764B7' }}>{sliders[slider.id]}</span>
                      <span style={{ fontSize: '0.875rem', color: '#6D6D6D' }}>{slider.rightAnchor}</span>
                    </div>
                  </div>
                ))}
              </div>

              {showNeutralWarning && (
                <div style={{ marginBottom: '1.5rem', padding: '1rem', borderRadius: '0.5rem', backgroundColor: '#FFF9E6', border: '1px solid #FFD700' }}>
                  <p style={{ marginBottom: '1rem', fontWeight: '500', color: '#333333' }}>
                    You've left everything at neutral. Is that correct?
                  </p>
                  <div style={{ display: 'flex', gap: '0.75rem' }}>
                    <button
                      onClick={proceedToCountdown}
                      style={{ 
                        flex: 1,
                        padding: '0.5rem 1rem',
                        borderRadius: '0.5rem',
                        fontWeight: '600',
                        backgroundColor: '#2764B7',
                        color: '#FFFFFF',
                        border: 'none',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#1e4f8f'}
                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#2764B7'}
                    >
                      Yes, continue
                    </button>
                    <button
                      onClick={() => setShowNeutralWarning(false)}
                      style={{ 
                        flex: 1,
                        padding: '0.5rem 1rem',
                        borderRadius: '0.5rem',
                        fontWeight: '600',
                        border: '2px solid #E0E0E0',
                        color: '#333333',
                        backgroundColor: '#FFFFFF',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#E0E0E0'}
                      onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#FFFFFF'}
                    >
                      Go back and adjust
                    </button>
                  </div>
                </div>
              )}

              <button
                onClick={handleSubmitSliders}
                style={{ 
                  width: '100%',
                  padding: '0.75rem 1.5rem',
                  borderRadius: '0.5rem',
                  fontWeight: '600',
                  fontSize: '1.125rem',
                  backgroundColor: '#2764B7',
                  color: '#FFFFFF',
                  border: 'none',
                  cursor: 'pointer',
                  boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
                  transition: 'all 0.2s'
                }}
                onMouseEnter={(e) => e.currentTarget.style.backgroundColor = '#1e4f8f'}
                onMouseLeave={(e) => e.currentTarget.style.backgroundColor = '#2764B7'}
              >
                Continue
              </button>

              <div style={{ marginTop: '2rem', paddingTop: '1.5rem', borderTop: '1px solid #E0E0E0' }}>
                <p style={{ fontSize: '0.75rem', lineHeight: '1.5', color: '#6D6D6D' }}>
                  <strong>About this tool:</strong> This assessment measures your current state across energetic arousal (energy/tiredness) and tense arousal (tension/calmness), plus engagement and cognitive noise. We use breathing as a fast lever on autonomic balance to help shift your state for optimal training.
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<CognitiveModeCheck />, document.getElementById('root'));
  </script>
</body>
</html>
